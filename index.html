<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EspÃ­a en JaÃ©n - SelecciÃ³n de Nivel</title>
    <style>
        :root { 
            --p: #2E7D32; --s: #81C784; --gold: #FFD700; --red: #d32f2f; 
            --dark: #0b1a2a; --wsp: #25D366;
        }
        body { font-family: 'Segoe UI', sans-serif; text-align: center; margin: 0; background: var(--dark); color: white; min-height: 100vh; }
        .screen { display: none; flex-direction: column; justify-content: center; align-items: center; padding: 20px; min-height: 100vh; box-sizing: border-box; }
        .active { display: flex; animation: fadeIn 0.4s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .card { background: white; color: #333; padding: 25px; border-radius: 30px; width: 100%; max-width: 420px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .btn { border: none; padding: 16px; border-radius: 15px; font-size: 1rem; font-weight: bold; width: 95%; cursor: pointer; margin: 8px 0; color: white; transition: 0.3s; }
        
        /* CATEGORÃAS ÃšNICAS */
        .cat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 15px 0; }
        .cat-btn { background: #444; padding: 15px 10px; border-radius: 15px; font-size: 0.85rem; border: 3px solid transparent; cursor: pointer; color: white; display: flex; flex-direction: column; gap: 5px; }
        .cat-btn.selected { border-color: var(--gold); background: var(--p); transform: scale(1.05); }

        .avatar-preview { width: 50px; height: 50px; border-radius: 10px; margin: 5px; border: 2px solid var(--s); background: white; }
        .cromo-pro { background: rgba(255,255,255,0.05); border: 2px solid var(--gold); border-radius: 15px; padding: 12px; width: 140px; margin: 8px; position: relative; }
        .cromo-img { width: 100%; height: 110px; object-fit: contain; border-radius: 10px; background: white; }
        .acc-icon { position: absolute; top: -10px; left: -10px; font-size: 2.2rem; z-index: 5; }
        
        footer { font-size: 0.7rem; padding: 20px; background: rgba(0,0,0,0.9); width: 100%; border-top: 2px solid var(--gold); }
    </style>
</head>
<body>

<div id="s1" class="screen active">
    <div style="background: rgba(0,0,0,0.7); padding: 25px; border-radius: 40px; border: 2px solid var(--s); width: 90%; max-width: 450px;">
        <h1>ğŸ•µï¸â€â™‚ï¸ EspÃ­a en JaÃ©n</h1>
        <div id="lista-previa" style="display:flex; justify-content:center; flex-wrap:wrap; margin-bottom:10px;"></div>
        
        <input type="text" id="in-nombre" placeholder="Tu nombre..." style="padding:15px; border-radius:15px; width:85%; margin:5px 0; border:none; text-align: center;">

        <p style="margin: 15px 0 5px;">ğŸ“ Selecciona Nivel (Ãšnico):</p>
        <div class="cat-grid">
            <div class="cat-btn selected" id="c-infantil" onclick="setCat('infantil')"><span>ğŸ‘¶ Infantil</span><small>(3-7 aÃ±os)</small></div>
            <div class="cat-btn" id="c-juvenil" onclick="setCat('juvenil')"><span>ğŸ® Juvenil</span><small>(8-12 aÃ±os)</small></div>
            <div class="cat-btn" id="c-adolescente" onclick="setCat('adolescente')"><span>ğŸ“± Adolescente</span><small>(13-17 aÃ±os)</small></div>
            <div class="cat-btn" id="c-plus" onclick="setCat('plus')"><span>ğŸ» +18</span><small>(Adultos)</small></div>
        </div>

        <button class="btn" style="background:var(--p);" onclick="usarAvatar()">ğŸ‘¤ AÃ‘ADIR JUGADOR</button>
        <button class="btn" id="btn-next" style="display:none; background:var(--gold); color:black;" onclick="mostrar('s-game-start')">SIGUIENTE ğŸš€</button>
    </div>
</div>

<div id="s-game-start" class="screen">
    <div class="card">
        <h3>ğŸš€ Â¡Preparados!</h3>
        <p id="info-nivel" style="font-weight: bold; color: var(--p);"></p>
        <p>Pasad el mÃ³vil en orden para ver vuestro rol secreto.</p>
        <button class="btn" style="background:var(--p)" onclick="comenzarPartida()">Â¡EMPEZAR JUEGO!</button>
    </div>
</div>

<div id="s-game" class="screen"></div>

<div id="s-podio" class="screen">
    <h1 style="color:var(--gold);">ğŸ‘‘ PODIO DE JAÃ‰N</h1>
    <div id="final-team-photo" style="display:flex; flex-wrap:wrap; justify-content:center; width:100%;"></div>
    <button class="btn" style="background:var(--wsp); width:auto; padding: 15px 40px;" onclick="location.reload()">REINICIAR</button>
</div>

<footer>
    <p>Proyecto Ciudades de AndalucÃ­a - JaÃ©n</p>
    <p>JaÃ©n Capital Â· Linares Â· AndÃºjar Â· Ãšbeda Â· Baeza Â· AlcalÃ¡ la Real</p>
</footer>

<script>
    const niveles = {
        infantil: {
            desc: "Nivel NiÃ±os (3-7): Palabras fÃ¡ciles con pistas visuales.",
            retos: [{t:"MÃMICA",i:"ğŸ¤¸"}, {t:"SONIDOS",i:"ğŸ¶"}, {t:"BAILE",i:"ğŸ’ƒ"}],
            palabras: [{p:"PERRO", e:"ğŸ¶", s:"ğŸ±"}, {p:"BOMBERO", e:"ğŸš’", s:"ğŸ‘®"}, {p:"SOL", e:"â˜€ï¸", s:"ğŸŒ™"}]
        },
        juvenil: {
            desc: "Nivel Juvenil (8-12): Retos de ingenio y cultura.",
            retos: [{t:"DIBUJO",i:"ğŸ¨"}, {t:"MÃMICA",i:"ğŸ­"}, {t:"TARAREAR",i:"ğŸµ"}],
            palabras: [{p:"OLIVAR", e:"ğŸŒ³"}, {p:"CASTILLO", e:"ğŸ°"}, {p:"FÃšTBOL", e:"âš½"}]
        },
        adolescente: {
            desc: "Nivel Adolescente (13-17): Redes sociales y moda.",
            retos: [{t:"POSE TIKTOK",i:"ğŸ¤³"}, {t:"RAPEAR",i:"ğŸ¤"}, {t:"MÃMICA",i:"ğŸ•º"}],
            palabras: [{p:"INFLUENCER", e:"ğŸ“¸"}, {p:"VIRAL", e:"ğŸš€"}, {p:"STREAMER", e:"ğŸ™ï¸"}]
        },
        plus: {
            desc: "Nivel +18: Conceptos complejos y cultura local.",
            retos: [{t:"CHISTE",i:"ğŸ˜‚"}, {t:"ACTUAR",i:"ğŸ¬"}, {t:"DEFINICIÃ“N",i:"ğŸ“–"}],
            palabras: [{p:"TAPEO", e:"ğŸº"}, {p:"RENACIMIENTO", e:"ğŸ›ï¸"}, {p:"COSECHA", e:"ğŸšœ"}]
        }
    };

    const pueblosJaen = [
        {n:"JaÃ©n Capital", c:"Tiene la Ãºnica Catedral de EspaÃ±a que sirviÃ³ de modelo para las de AmÃ©rica."},
        {n:"Linares", c:"Es la cuna del cante de las minas y del ajedrez mundial."},
        {n:"AndÃºjar", c:"En su sierra vive el Lince IbÃ©rico, el felino mÃ¡s amenazado del mundo."},
        {n:"Ãšbeda", c:"Se la conoce como la 'Ciudad del Oro Verde' por su aceite y su arquitectura."},
        {n:"Baeza", c:"AquÃ­ el poeta Antonio Machado fue profesor de francÃ©s muchos aÃ±os."},
        {n:"AlcalÃ¡ la Real", c:"Su Fortaleza de la Mota era la llave de entrada al antiguo Reino de Granada."}
    ];

    let jugadores = [], categoria = 'infantil', partida = {};

    function setCat(c) {
        categoria = c;
        document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('selected'));
        document.getElementById('c-'+c).classList.add('selected');
        document.getElementById('info-nivel').innerText = niveles[c].desc;
    }

    function usarAvatar() {
        const rawN = document.getElementById('in-nombre').value.trim().toUpperCase();
        const n = rawN || "AGENTE "+(jugadores.length+1);
        let acc = ""; 
        if(n.includes("PE")) acc="ğŸŒˆ"; 
        else if(n.includes("HACHE")) acc="ğŸ‘®"; 
        else if(n.includes("JOTA")) acc="ğŸ‘¨â€ğŸš’";

        // Crear avatar simple con color aleatorio
        const color = `hsl(${Math.random()*360}, 70%, 80%)`;
        const c = document.createElement('canvas'); c.width=200; c.height=200;
        const ctx = c.getContext('2d');
        ctx.fillStyle = color; ctx.fillRect(0,0,200,200);
        ctx.font = "100px Arial"; ctx.textAlign="center"; ctx.textBaseline="middle";
        ctx.fillText(n[0], 100, 110);

        jugadores.push({nombre:n, foto:c.toDataURL(), puntos:0, medallas:[], acc});
        document.getElementById('lista-previa').innerHTML += `<img src="${c.toDataURL()}" class="avatar-preview" style="border-color:${color}">`;
        document.getElementById('in-nombre').value = "";
        if(jugadores.length >= 3) document.getElementById('btn-next').style.display="block";
    }

    function mostrar(id){
        document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    function comenzarPartida() {
        const config = niveles[categoria];
        const pObj = config.palabras[Math.floor(Math.random()*config.palabras.length)];
        partida = { 
            palabra: pObj, 
            espiaIdx: Math.floor(Math.random()*jugadores.length), 
            turno: 0 
        };
        jugadores.forEach(j => j.reto = config.retos[Math.floor(Math.random()*config.retos.length)]);
        verTurno();
    }

    function verTurno() {
        mostrar('s-game');
        const j = jugadores[partida.turno];
        document.getElementById('s-game').innerHTML = `
            <div class="card" onclick="revelar()">
                <h1 style="font-size:3rem;">${j.acc || 'ğŸ•µï¸'}</h1>
                <h2>Turno de: ${j.nombre}</h2>
                <p>TOCA PARA VER TU SECRETO</p>
            </div>`;
    }

    function revelar() {
        const j = jugadores[partida.turno];
        const esE = (partida.turno === partida.espiaIdx);
        let html = esE ? `<h2 style="color:var(--red)">Â¡ERES EL ESPÃA!</h2>` : `<h2>PALABRA:<br>${partida.palabra.p} ${partida.palabra.e}</h2>`;
        
        if(esE && categoria === 'infantil') {
            html += `<p>Pista: Es parecido a un/a <b>${partida.palabra.s}</b></p>`;
        }

        document.getElementById('s-game').innerHTML = `
            <div class="card">
                ${html}
                <div style="background:#eee; padding:15px; border-radius:15px; margin:15px 0;">
                    <strong>RETO: ${j.reto.t} ${j.reto.i}</strong>
                </div>
                <button class="btn" style="background:var(--p)" onclick="nextT()">OK, LO TENGO</button>
            </div>`;
    }

    function nextT() {
        partida.turno++;
        if(partida.turno < jugadores.length) verTurno();
        else finalRonda();
    }

    function finalRonda() {
        const pueblo = pueblosJaen[Math.floor(Math.random()*pueblosJaen.length)];
        jugadores.forEach(j => { j.puntos += 10; j.medallas.push(pueblo); });
        mostrar('s-podio');
        renderPodio();
    }

    function renderPodio() {
        document.getElementById('final-team-photo').innerHTML = jugadores.map(j => `
            <div class="cromo-pro">
                <div class="acc-icon">${j.acc || ''}</div>
                <img src="${j.foto}" class="cromo-img">
                <div style="margin-top:5px;"><b>${j.nombre}</b></div>
                <div style="font-size:0.7rem; color:#ccc;">ğŸ… ${j.medallas[0].n}</div>
                <div style="font-size:0.6rem; margin-top:5px; line-height:1;">${j.medallas[0].c}</div>
            </div>`).join('');
    }

    // Inicializar descripciÃ³n
    setCat('infantil');
</script>
</body>
</html>
