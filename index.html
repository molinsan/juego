<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EspÃ­a en JaÃ©n - EdiciÃ³n 2026</title>
    <style>
        :root { --p: #2E7D32; --s: #81C784; --gold: #FFD700; --red: #d32f2f; --dark: #0b1a2a; }
        body { font-family: 'Segoe UI', sans-serif; text-align: center; margin: 0; background: var(--dark); color: white; height: 100vh; overflow-x: hidden; }
        .screen { display: none; flex-direction: column; align-items: center; padding: 10px; min-height: 100vh; box-sizing: border-box; }
        .active { display: flex; }

        .main-card { background: rgba(0,0,0,0.85); padding: 12px; border-radius: 20px; border: 2px solid var(--s); width: 95%; max-width: 400px; display: flex; flex-direction: column; gap: 6px; }
        
        /* Bloqueo de CategorÃ­a */
        .cat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; }
        .cat-btn { background: #333; padding: 8px; border-radius: 10px; font-size: 0.75rem; border: 2px solid transparent; cursor: pointer; color: white; }
        .cat-btn.selected { background: var(--p); border-color: var(--gold); }
        .cat-btn.disabled { opacity: 0.4; cursor: not-allowed; }

        .avatar-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 4px; padding: 5px; background: rgba(255,255,255,0.05); border-radius: 10px; }
        .av-item { font-size: 1.3rem; cursor: pointer; border-radius: 5px; border: 2px solid transparent; }
        .av-item.selected { border-color: var(--gold); background: rgba(255,255,255,0.1); }

        /* Wanted Frame */
        .wanted-container { 
            width: 280px; height: 380px; position: relative; margin: auto;
            background: url('wanted_frame.png') no-repeat center/contain;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .wanted-photo { width: 160px; height: 160px; object-fit: cover; border: 3px solid #3d2b1f; transform: rotate(-1deg); margin-top: 15px; }
        .wanted-name { font-family: 'Courier New', serif; font-weight: bold; color: #3d2b1f; margin-top: 15px; font-size: 1.4rem; }

        .btn { border: none; padding: 12px; border-radius: 12px; font-weight: bold; width: 100%; cursor: pointer; }
        input[type="text"] { padding: 10px; border-radius: 10px; border: none; width: 100%; box-sizing: border-box; }
    </style>
</head>
<body>

<div id="s1" class="screen active">
    <div class="main-card">
        <h1 style="font-size:1.2rem; color:var(--gold); margin:2px;">ğŸ•µï¸ ESPÃA EN JAÃ‰N</h1>
        <div id="lista-previa" style="display:flex; justify-content:center; gap:4px; flex-wrap:wrap; min-height:30px;"></div>
        
        <input type="text" id="in-nombre" placeholder="Nombre...">
        
        <div style="display:flex; align-items:center; gap:10px; background:rgba(255,255,255,0.1); padding:5px; border-radius:10px;">
            <div class="avatar-grid" id="av-grid" style="flex:1;">
                <div class="av-item selected" onclick="selAv(this,'ğŸŒˆ')">ğŸŒˆ</div>
                <div class="av-item" onclick="selAv(this,'ğŸ‘®')">ğŸ‘®</div>
                <div class="av-item" onclick="selAv(this,'ğŸ‘¨â€ğŸš’')">ğŸ‘¨â€ğŸš’</div>
                <div class="av-item" onclick="selAv(this,'ğŸ¦')">ğŸ¦</div>
                <div class="av-item" onclick="selAv(this,'ğŸ«’')">ğŸ«’</div>
                <div class="av-item" onclick="selAv(this,'ğŸ•µï¸')">ğŸ•µï¸</div>
            </div>
            <input type="color" id="avatar-color" value="#ffffff" style="width:35px; height:35px; border:none; background:none;">
        </div>

        <div class="cat-grid" id="cat-container">
            <div class="cat-btn" id="cat-infantil" onclick="fijarCat('infantil')">ğŸ‘¶ Infantil</div>
            <div class="cat-btn" id="cat-junior" onclick="fijarCat('junior')">ğŸ® Junior</div>
            <div class="cat-btn" id="cat-adolescente" onclick="fijarCat('adolescente')">ğŸ“± Adolescente</div>
            <div class="cat-btn" id="cat-adulto" onclick="fijarCat('adulto')">ğŸº Adulto</div>
        </div>

        <div style="display:flex; gap:5px;">
            <button class="btn" style="background:#444; color:white; flex:1;" onclick="iniciarCamara()">ğŸ“¸ SELFIE</button>
            <button class="btn" style="background:var(--p); color:white; flex:1;" onclick="usarAvatar()">ğŸ‘¤ AVATAR</button>
        </div>
        <button class="btn" id="btn-next" style="display:none; background:var(--gold)" onclick="mostrar('s-retos')">SIGUIENTE ğŸš€</button>
    </div>
</div>

<div id="s-cam" class="screen" style="background:black; justify-content:center;">
    <video id="v" style="width:90%; border-radius:20px; transform: scaleX(-1);" autoplay playsinline></video>
    <button class="btn" onclick="capturarFoto()" style="background:white; color:black; border-radius:50%; width:70px; height:70px; margin-top:15px;">ğŸ“¸</button>
</div>

<div id="s-retos" class="screen"></div>
<div id="s-game" class="screen"></div>

<script>
    // Palabras y LÃ³gica
    const niveles = {
        infantil: [{p:"SOL â˜€ï¸", s:"LUNA ğŸŒ™"}, {p:"PERRO ğŸ¶", s:"LOBO ğŸº"}, {p:"PEZ ğŸŸ", s:"RANA ğŸ¸"}],
        junior: [{p:"PIZZA", s:"PASTA"}],
        adolescente: [{p:"TIKTOK", s:"REELS"}],
        adulto: [{p:"ACEITE", s:"VINO"}]
    };

    // Auto-relleno a 100 para demo
    for(let n in niveles) while(niveles[n].length < 100) niveles[n].push({p: niveles[n][0].p + niveles[n].length, s: niveles[n][0].s});

    let jugadores=[], categoria='', catFijada=false, avatarActivo='ğŸŒˆ', stream;

    function fijarCat(c) {
        if(catFijada) return;
        categoria = c; catFijada = true;
        document.querySelectorAll('.cat-btn').forEach(b => {
            b.classList.add('disabled');
            if(b.id === 'cat-'+c) b.classList.add('selected'), b.classList.remove('disabled');
        });
    }

    function selAv(el, icon) {
        document.querySelectorAll('.av-item').forEach(i=>i.classList.remove('selected'));
        el.classList.add('selected'); avatarActivo = icon;
    }

    async function iniciarCamara() {
        if(!categoria) return alert("Elige primero el nivel");
        try {
            stream = await navigator.mediaDevices.getUserMedia({video:{facingMode:'user'}});
            document.getElementById('v').srcObject = stream;
            mostrar('s-cam');
        } catch(e) { alert("CÃ¡mara no disponible"); }
    }

    function capturarFoto() {
        const v=document.getElementById('v'), c=document.createElement('canvas');
        c.width=200; c.height=200;
        const ctx=c.getContext('2d'); ctx.translate(200,0); ctx.scale(-1,1); ctx.drawImage(v,0,0,200,200);
        addJ(c.toDataURL());
        if(stream) stream.getTracks().forEach(t=>t.stop());
        mostrar('s1');
    }

    function usarAvatar() {
        if(!categoria) return alert("Elige primero el nivel");
        const col = document.getElementById('avatar-color').value;
        const c = document.createElement('canvas'); c.width=200; c.height=200;
        const ctx = c.getContext('2d');
        ctx.fillStyle = col; ctx.fillRect(0,0,200,200);
        ctx.font = "100px serif"; ctx.textAlign="center"; ctx.textBaseline="middle"; ctx.fillText(avatarActivo, 100, 110);
        addJ(c.toDataURL());
    }

    function addJ(img) {
        const nom = document.getElementById('in-nombre').value || "JUGADOR";
        jugadores.push({nombre: nom.toUpperCase(), foto: img, puntos:0});
        document.getElementById('lista-previa').innerHTML += `<img src="${img}" style="width:30px; height:30px; border-radius:50%; border:1px solid var(--gold)">`;
        document.getElementById('in-nombre').value = "";
        if(jugadores.length>=3) document.getElementById('btn-next').style.display="block";
    }

    function mostrar(id){
        document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    // El resto de la lÃ³gica de juego permanece igual...
</script>
</body>
</html>
