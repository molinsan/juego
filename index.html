<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>M√≠mica Andaluc√≠a PRO</title>
    <style>
        :root { 
            --p: #2E7D32; /* Verde Andaluc√≠a */
            --s: #81C784; 
            --dark: #0b1a2a; 
            --gold: #FFD700; 
        }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            text-align: center; margin: 0; background: var(--dark); color: white; 
            overflow: hidden; touch-action: manipulation; 
        }
        .screen { display: none; height: 100vh; flex-direction: column; justify-content: center; align-items: center; padding: 20px; box-sizing: border-box; }
        .active { display: flex; }
        .card { 
            background: white; color: #333; padding: 20px; border-radius: 20px; 
            width: 95%; max-width: 400px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); 
        }
        .btn { 
            background: var(--p); color: white; border: none; padding: 15px; border-radius: 15px; 
            font-size: 1.1rem; font-weight: bold; width: 85%; cursor: pointer; margin: 8px 0; text-decoration: none; display: inline-block;
        }

        /* MOTOR DE RECORTE (SPRITE) */
        .sprite-container { 
            width: 200px; height: 200px; margin: 10px auto; 
            border-radius: 15px; border: 4px solid var(--p); 
            overflow: hidden; background: #eee; 
            display: flex; justify-content: flex-start; align-items: flex-start; 
        }
        #v-sprite { display: block; width: 1024px; pointer-events: none; }

        /* LISTA JUGADORES */
        #lista-jugadores { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin-bottom: 15px; }
        .perfil { position: relative; width: 70px; }
        .perfil img { width: 60px; height: 60px; border-radius: 50%; border: 3px solid var(--s); object-fit: cover; }
        .puntos-tag { position: absolute; top: -5px; right: 0; background: var(--gold); color: black; font-size: 0.7rem; padding: 2px 5px; border-radius: 8px; font-weight: bold; }

        /* CAMARA */
        #camera-feed { width: 100%; border-radius: 20px; background: #000; transform: scaleX(-1); }

        /* CARTEL WANTED */
        .wanted-container {
            background-image: url('wanted_frame.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            width: 100%;
            max-width: 400px;
            height: 500px;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }
        .wanted-photo-frame { 
            width: 215px; height: 215px; margin-top: 118px; 
            overflow: hidden; border: 2px solid #3d2b1f;
        }
        .wanted-photo-frame img { width: 100%; height: 100%; object-fit: cover; filter: sepia(0.8); }
        .wanted-text-name { margin-top: 15px; font-family: 'Courier New', monospace; font-weight: bold; font-size: 1.8rem; color: #3d2b1f; text-transform: uppercase; }

        /* FOOTER INFO */
        .footer-links { margin-top: 15px; font-size: 0.8rem; }
        .footer-links a { color: var(--s); text-decoration: none; margin: 0 10px; }
    </style>
</head>
<body>

<div id="s1" class="screen active">
    <h1 style="color:var(--s)">üè∞ Proyecto Andaluc√≠a</h1>
    <div id="lista-jugadores"></div>
    <input type="text" id="in-nombre" placeholder="Nombre..." style="padding:12px; border-radius:10px; width:70%; border:none;">
    <button class="btn" style="background:var(--s); color:black" onclick="abrirCamara()">üì∏ A√ëADIR JUGADOR</button>
    
    <select id="select-nivel" style="padding:10px; margin-top:10px; width:75%; border-radius:10px;">
        <option value="exploradores">üçº Exploradores (1-12)</option>
        <option value="junior">üéí Junior (1-12)</option>
        <option value="adulto">üç∑ Adulto (1-12)</option>
    </select>
    
    <button class="btn" onclick="iniciarJuego()">¬°EMPEZAR PARTIDA! üöÄ</button>

    <div class="footer-links">
        <a href="mailto:molinsan.jl@gmail.com">üì© Sugerencias</a>
        <a href="https://paypal.me/7moli/tu-usuario" target="_blank">‚òï Inv√≠tame a un caf√©</a>
    </div>
</div>

<div id="s-cam" class="screen">
    <video id="camera-feed" autoplay playsinline></video>
    <button class="btn" onclick="tomarFoto()">CAPTURAR üì∏</button>
    <button class="btn" style="background:#555" onclick="cerrarCamara()">CANCELAR</button>
</div>

<div id="s2" class="screen">
    <div id="tap-card" class="card" onclick="revelarPalabra()">
        <h2 id="turno-de"></h2>
        <div style="font-size:5rem">ü§ê</div>
        <p>TOCA PARA VER TU PALABRA</p>
    </div>
    <div id="info-card" class="card" style="display:none">
        <h3 id="msg-rol"></h3>
        <div class="sprite-container" id="box-imagen">
            <img id="v-sprite" src="">
        </div>
        <h2 id="v-palabra" style="color:var(--p)"></h2>
        <div style="background:#eee; padding:10px; border-radius:10px">
            <span id="v-mision"></span>
        </div>
        <button class="btn" onclick="terminarTurno()">¬°LISTO! ‚úÖ</button>
    </div>
</div>

<div id="s3" class="screen">
    <div class="wanted-container">
        <div class="wanted-photo-frame">
            <img id="wanted-img" src="">
        </div>
        <div class="wanted-text-name" id="wanted-nombre"></div>
    </div>
    <button class="btn" onclick="irARanking()" style="margin-top:20px">VER PUNTUACIONES</button>
</div>

<div id="s4" class="screen">
    <div class="card">
        <h2>Ranking Final</h2>
        <div id="ranking-box" style="text-align:left"></div>
        <div style="margin-top:20px; border-top: 1px solid #ddd; padding-top:10px;">
            <p style="font-size:0.9rem">¬øTe gusta el juego?</p>
            <a href="https://paypal.me/7moli" class="btn" style="background:#0070ba; font-size:0.9rem;">Donar con PayPal üíô</a>
        </div>
    </div>
    <button class="btn" onclick="location.reload()">NUEVA PARTIDA üîÑ</button>
</div>

<script>
    const CONFIG = { total: 1024, cols: 3, filas: 4 };
    const db = {
        exploradores: ["GATO", "PERRO", "PATO", "CONEJO", "COCHE", "ELEFANTE", "PELOTA", "SOL", "LUNA", "PLATANO", "MANZANA", "FLOR"],
        junior: ["BOMBERO", "POLICIA", "ASTRONAUTA", "PIRATA", "DINOSAURIO", "DRAGON", "MAGO", "SUPERHEROE", "CHEF", "FUTBOLISTA", "CIENTIFICO", "EXPLORADOR"],
        adulto: ["CAFE", "PIZZA", "HIPOTECA", "RESACA", "TRABAJO", "VIAJE", "GIMNASIO", "COMPRA", "MOVIL", "RELOJ", "DORMIR", "DINERO"]
    };
    const misiones = ["üêå C√°mara Lenta", "üîä Con Ruidos", "üñêÔ∏è Solo Manos", "ü§ñ Modo Robot", "üëÉ Con la Nariz"];

    let jugadores = [];
    let partida = {};
    let stream;

    async function abrirCamara() {
        if(!document.getElementById('in-nombre').value) return alert("Escribe un nombre");
        mostrar('s-cam');
        stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } });
        document.getElementById('camera-feed').srcObject = stream;
    }

    function cerrarCamara() {
        if(stream) stream.getTracks().forEach(t => t.stop());
        mostrar('s1');
    }

    function tomarFoto() {
        const video = document.getElementById('camera-feed');
        const canvas = document.createElement('canvas');
        canvas.width = 400; canvas.height = 400;
        const ctx = canvas.getContext('2d');
        ctx.translate(400, 0); ctx.scale(-1, 1);
        ctx.drawImage(video, 0, 0, 400, 400);
        
        jugadores.push({
            nombre: document.getElementById('in-nombre').value.toUpperCase(),
            foto: canvas.toDataURL(),
            puntos: 0
        });
        document.getElementById('in-nombre').value = "";
        cerrarCamara();
        actualizarLista();
    }

    function actualizarLista() {
        document.getElementById('lista-jugadores').innerHTML = jugadores.map(j => `
            <div class="perfil">
                <div class="puntos-tag">${j.puntos}</div>
                <img src="${j.foto}">
            </div>
        `).join('');
    }

    function iniciarJuego() {
        if(jugadores.length < 3) return alert("M√≠nimo 3 jugadores");
        const nivel = document.getElementById('select-nivel').value;
        const listaPalabras = db[nivel];
        const randomWord = listaPalabras[Math.floor(Math.random() * listaPalabras.length)];

        partida = {
            nivel: nivel,
            palabra: randomWord,
            idxPalabra: listaPalabras.indexOf(randomWord),
            espiaIdx: Math.floor(Math.random() * jugadores.length),
            turnoActual: 0,
            mision: misiones[Math.floor(Math.random() * misiones.length)]
        };
        mostrar('s2');
        prepararTurno();
    }

    function prepararTurno() {
        document.getElementById('turno-de').innerText = "TURNO: " + jugadores[partida.turnoActual].nombre;
        document.getElementById('tap-card').style.display = "block";
        document.getElementById('info-card').style.display = "none";
    }

    function revelarPalabra() {
        const esEspia = (partida.turnoActual === partida.espiaIdx);
        document.getElementById('tap-card').style.display = "none";
        document.getElementById('info-card').style.display = "block";

        if(esEspia) {
            document.getElementById('msg-rol').innerText = "ü§´ ERES EL ESP√çA";
            document.getElementById('v-palabra').innerText = "¬°DISIMULA!";
            document.getElementById('box-imagen').style.display = "none";
            document.getElementById('v-mision').innerText = "M√©zclate con los dem√°s...";
        } else {
            document.getElementById('msg-rol').innerText = "TU PALABRA ES:";
            document.getElementById('v-palabra').innerText = partida.palabra;
            document.getElementById('box-imagen').style.display = "flex";
            document.getElementById('v-mision').innerText = "MODO: " + partida.mision;
            
            const img = document.getElementById('v-sprite');
            img.src = `./${partida.nivel}1-12.jpeg`;
            const f = CONFIG.total / CONFIG.cols;
            const col = partida.idxPalabra % CONFIG.cols;
            const fila = Math.floor(partida.idxPalabra / CONFIG.cols);
            img.style.transform = `translate(${-col * f}px, ${-fila * f}px)`;
        }
    }

    function terminarTurno() {
        partida.turnoActual++;
        if(partida.turnoActual < jugadores.length) {
            prepararTurno();
        } else {
            revelarEspia();
        }
    }

    function revelarEspia() {
        const espia = jugadores[partida.espiaIdx];
        document.getElementById('wanted-img').src = espia.foto;
        document.getElementById('wanted-nombre').innerText = espia.nombre;
        mostrar('s3');
    }

    function irARanking() {
        jugadores.forEach((j, i) => {
            if(i === partida.espiaIdx) j.puntos -= 10;
            else j.puntos += 5;
        });
        
        const box = document.getElementById('ranking-box');
        box.innerHTML = jugadores
            .sort((a,b) => b.puntos - a.puntos)
            .map(j => `<p><strong>${j.nombre}:</strong> ${j.puntos} puntos</p>`)
            .join('');
        mostrar('s4');
    }

    function mostrar(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }
</script>
</body>
</html>






