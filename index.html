<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>M√≠mica Andaluc√≠a PRO</title>
    <style>
        :root { --p: #2E7D32; --s: #81C784; --dark: #0b1a2a; --gold: #FFD700; }
        body { font-family: 'Segoe UI', sans-serif; text-align: center; margin: 0; background: var(--dark); color: white; overflow: hidden; display: flex; flex-direction: column; }
        .screen { display: none; flex: 1; flex-direction: column; justify-content: center; align-items: center; padding: 20px; box-sizing: border-box; }
        .active { display: flex; }
        .card { background: white; color: #333; padding: 20px; border-radius: 20px; width: 95%; max-width: 400px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .btn { background: var(--p); color: white; border: none; padding: 15px; border-radius: 15px; font-size: 1.1rem; font-weight: bold; width: 85%; cursor: pointer; margin: 8px 0; }
        
        .emoji-display { font-size: 7rem; margin: 10px 0; }
        .perfil-img { width: 60px; height: 60px; border-radius: 50%; border: 3px solid var(--s); object-fit: cover; margin: 5px; }
        #camera-feed { width: 100%; border-radius: 20px; transform: scaleX(-1); background: #222; }

        .wanted-container {
            background-image: url('wanted_frame.png');
            background-size: contain; background-repeat: no-repeat; background-position: center;
            width: 320px; height: 420px; display: flex; flex-direction: column; align-items: center;
        }
        .wanted-photo-frame { width: 175px; height: 175px; margin-top: 100px; overflow: hidden; border: 2px solid #3d2b1f; background: #eee; }
        .wanted-photo-frame img { width: 100%; height: 100%; object-fit: cover; filter: sepia(0.8); }
        
        footer { font-size: 0.8rem; padding: 10px; background: rgba(0,0,0,0.3); color: #aaa; }
        .modo-box { font-size: 1.3rem; font-weight: bold; color: var(--p); background: #f0fdf4; padding: 15px; border-radius: 15px; margin: 10px 0; border: 2px dashed var(--p); }
    </style>
</head>
<body>

<div id="s1" class="screen active">
    <h1 style="color:var(--s); margin-bottom:5px;">üè∞ Proyecto Andaluc√≠a</h1>
    <div id="lista-jugadores"></div>
    <input type="text" id="in-nombre" placeholder="Nombre..." style="padding:12px; border-radius:10px; width:70%; border:none; margin-bottom:10px;">
    <button class="btn" style="background:var(--s); color:black" onclick="abrirCamara()">üì∏ A√ëADIR JUGADOR</button>
    
    <select id="select-nivel" style="padding:12px; width:85%; border-radius:10px; margin:10px 0;">
        <option value="exp">üçº Exploradores (4-8 a√±os)</option>
        <option value="jun">üéí Junior (9-15 a√±os)</option>
        <option value="ado">üì± Adolescente (16-17 a√±os)</option>
        <option value="adu">üç∑ Adultos (+18 a√±os)</option>
    </select>
    
    <button class="btn" onclick="iniciarJuego()">¬°EMPEZAR PARTIDA! üöÄ</button>
</div>

<div id="s-cam" class="screen">
    <video id="camera-feed" autoplay playsinline></video>
    <button class="btn" onclick="tomarFoto()">CAPTURAR FOTO üì∏</button>
</div>

<div id="s2" class="screen">
    <div id="tap-card" class="card" onclick="revelarPalabra()">
        <h2 id="turno-de"></h2>
        <p>TOCA PARA VER TU SECRETO</p>
    </div>
    <div id="info-card" class="card" style="display:none">
        <h3 id="msg-rol"></h3>
        <div id="box-imagen" class="emoji-display"></div>
        <h2 id="v-palabra" style="color:var(--p)"></h2>
        <button class="btn" onclick="terminarTurno()">LISTO ‚úÖ</button>
    </div>
</div>

<div id="s-misiones" class="screen">
    <div class="card">
        <h2 id="mision-jugador-nombre"></h2>
        <p>Tu forma de actuar es:</p>
        <div class="modo-box" id="mision-texto"></div>
        <button class="btn" onclick="siguienteMision()">¬°HECHO! ‚ñ∂Ô∏è</button>
    </div>
</div>

<div id="s-voto" class="screen">
    <div class="card">
        <h2 id="votante-nombre" style="color:var(--p)"></h2>
        <p>Vota: ¬øQui√©n es el esp√≠a?</p>
        <div id="botones-voto"></div>
    </div>
</div>

<div id="s-wanted" class="screen">
    <div class="wanted-container">
        <div class="wanted-photo-frame"><img id="wanted-img" src=""></div>
        <h2 id="wanted-nombre" style="color:#3d2b1f; margin-top:10px; font-family:serif"></h2>
    </div>
    <div id="resultado-final" style="margin-top:10px"></div>
    <button class="btn" onclick="location.reload()">NUEVA PARTIDA üîÑ</button>
</div>

<footer>
    üìß molinsan.jl@gmail.com | üí∏ PayPal: 7moli
</footer>

<script>
    const db = {
        exp: [
            {p:"LE√ìN",e:"ü¶Å"},{p:"GATO",e:"üê±"},{p:"PERRO",e:"üê∂"},{p:"PATO",e:"ü¶Ü"},{p:"SAPO",e:"üê∏"},{p:"CONEJO",e:"üê∞"},{p:"MONO",e:"üêµ"},{p:"CERDO",e:"üê∑"},{p:"ELEFANTE",e:"üêò"},{p:"JIRAFA",e:"ü¶í"},{p:"SOL",e:"‚òÄÔ∏è"},{p:"LUNA",e:"üåô"},{p:"LLUVIA",e:"üåßÔ∏è"},{p:"PELOTA",e:"‚öΩ"},{p:"BICICLETA",e:"üö≤"},{p:"TREN",e:"üöÇ"},{p:"AVI√ìN",e:"‚úàÔ∏è"},{p:"BARCO",e:"üö¢"},{p:"HELADO",e:"üç¶"},{p:"MANZANA",e:"üçé"},{p:"PL√ÅTANO",e:"üçå"},{p:"FLOR",e:"üå∏"},{p:"√ÅRBOL",e:"üå≥"},{p:"CASA",e:"üè†"},{p:"COCHE",e:"üöó"},{p:"MU√ëECA",e:"ü™Ü"},{p:"DORMIR",e:"üò¥"},{p:"COMER",e:"üçï"},{p:"BEBER",e:"ü•§"},{p:"LLORAR",e:"üò¢"},{p:"REIR",e:"üòÇ"},{p:"NADAR",e:"üèä"},{p:"CORRER",e:"üèÉ"},{p:"SALTAR",e:"ü¶ò"},{p:"BAILAR",e:"üíÉ"},{p:"PINTAR",e:"üé®"},{p:"ZAPATOS",e:"üëü"},{p:"SOMBRERO",e:"üëí"},{p:"GAFAS",e:"üëì"},{p:"RELOJ",e:"‚åö"},{p:"PEZ",e:"üêü"},{p:"P√ÅJARO",e:"üê¶"},{p:"MARIPOSA",e:"ü¶ã"},{p:"ARA√ëA",e:"üï∑Ô∏è"},{p:"LIBRO",e:"üìñ"},{p:"TELE",e:"üì∫"},{p:"CEPILLO",e:"ü™•"},{p:"DULCE",e:"üç≠"},{p:"REGALO",e:"üéÅ"},{p:"FIESTA",e:"ü•≥"}
        ],
        jun: [
            {p:"POLIC√çA",e:"üëÆ"},{p:"BOMBERO",e:"üë®‚Äçüöí"},{p:"CHEF",e:"üë®‚Äçüç≥"},{p:"M√âDICO",e:"üë®‚Äç‚öïÔ∏è"},{p:"PROFESOR",e:"üë®‚Äçüè´"},{p:"ASTRONAUTA",e:"üë®‚ÄçüöÄ"},{p:"PIRATA",e:"üè¥‚Äç‚ò†Ô∏è"},{p:"MAGO",e:"üßô"},{p:"SUPERH√âROE",e:"ü¶∏"},{p:"ZOMBI",e:"üßü"},{p:"FUTBOLISTA",e:"‚öΩ"},{p:"TENISTA",e:"üéæ"},{p:"GUITARRA",e:"üé∏"},{p:"PIANO",e:"üéπ"},{p:"C√ÅMARA",e:"üì∑"},{p:"ORDENADOR",e:"üíª"},{p:"HAMBURGUESA",e:"üçî"},{p:"SUSHI",e:"üç£"},{p:"DINOSAURIO",e:"ü¶ñ"},{p:"DRAG√ìN",e:"üêâ"},{p:"ROBOT",e:"ü§ñ"},{p:"CIENT√çFICO",e:"üß™"},{p:"DETECTIVE",e:"üïµÔ∏è"},{p:"EXPLORADOR",e:"ü§†"},{p:"ESQUIAR",e:"‚õ∑Ô∏è"},{p:"SURF",e:"üèÑ"},{p:"SKATE",e:"üõπ"},{p:"VIDEOJUEGOS",e:"üéÆ"},{p:"CINE",e:"üé¨"},{p:"MOCHILA",e:"üéí"},{p:"DINERO",e:"üí∞"},{p:"LLAVE",e:"üîë"},{p:"TEL√âFONO",e:"üì±"},{p:"AURICULARES",e:"üéß"},{p:"MICR√ìFONO",e:"üé§"},{p:"MAPA",e:"üó∫Ô∏è"},{p:"BR√öJULA",e:"üß≠"},{p:"COHETE",e:"üöÄ"},{p:"TESORO",e:"üíé"},{p:"CANTAR",e:"üé§"},{p:"PESCAR",e:"üé£"},{p:"BOXEO",e:"ü•ä"},{p:"ESGRIMA",e:"ü§∫"},{p:"BICICLETA",e:"üö≤"},{p:"MOTOCICLETA",e:"üèçÔ∏è"},{p:"TRACTOR",e:"üöú"},{p:"HELIC√ìPTERO",e:"üöÅ"},{p:"PARACA√çDAS",e:"ü™Ç"},{p:"CAMPING",e:"‚õ∫"},{p:"HOGUERA",e:"üî•"}
        ],
        ado: [
            {p:"INFLUENCER",e:"ü§≥"},{p:"TIKTOK",e:"üíÉ"},{p:"EXAMEN",e:"üìù"},{p:"GRADUACI√ìN",e:"üéì"},{p:"PRIMER BESO",e:"üòò"},{p:"CONCIERTO",e:"üé∏"},{p:"GIMNASIO",e:"üèãÔ∏è"},{p:"MODA",e:"üëó"},{p:"VIAJE",e:"‚úàÔ∏è"},{p:"FIESTA",e:"üéâ"},{p:"AMOR",e:"‚ù§Ô∏è"},{p:"DESAMOR",e:"üíî"},{p:"SUE√ëO",e:"üò¥"},{p:"TRABAJO",e:"üíº"},{p:"COCHE NUEVO",e:"üèéÔ∏è"},{p:"PIZZA",e:"üçï"},{p:"CAF√â",e:"‚òï"},{p:"HAMBURGUESA",e:"üçî"},{p:"DORMIR",e:"üí§"},{p:"M√öSICA",e:"üéß"},{p:"PEL√çCULA",e:"üçø"},{p:"COMPRAS",e:"üõçÔ∏è"},{p:"PLAYA",e:"üèñÔ∏è"},{p:"MONTA√ëA",e:"üèîÔ∏è"},{p:"FOTO",e:"üì∏"},{p:"WHATSAPP",e:"üí¨"},{p:"ESTUDIAR",e:"üìö"},{p:"VACACIONES",e:"üçπ"},{p:"DEPORTE",e:"‚õπÔ∏è"},{p:"NATURALEZA",e:"üåø"},{p:"AMIGOS",e:"üë´"},{p:"FAMILIA",e:"üë®‚Äçüë©‚Äçüëß"},{p:"FUTURO",e:"üîÆ"},{p:"DINERO",e:"üí∏"},{p:"TIEMPO",e:"‚è≥"},{p:"LIBERTAD",e:"üïäÔ∏è"},{p:"AVENTURA",e:"üßó"},{p:"YOUTUBER",e:"üì∫"},{p:"GAMER",e:"üñ±Ô∏è"},{p:"NETFLIX",e:"üçø"},{p:"S√ÅBADO",e:"üï∫"},{p:"DOMINGO",e:"üõå"},{p:"LUNES",e:"üò´"},{p:"VERANO",e:"‚òÄÔ∏è"},{p:"INVIERNO",e:"‚ùÑÔ∏è"},{p:"CINE",e:"üéüÔ∏è"},{p:"CONDUCIR",e:"üöó"},{p:"ESTR√âS",e:"ü§Ø"},{p:"FELICIDAD",e:"üòä"},{p:"SELFIE",e:"ü§≥"}
        ],
        adu: [
            {p:"HIPOTECA",e:"üè†"},{p:"IMPUESTOS",e:"üßæ"},{p:"TRABAJO",e:"üíº"},{p:"REUNI√ìN",e:"ü§ù"},{p:"ESTR√âS",e:"üò´"},{p:"CAF√â",e:"‚òï"},{p:"VINO",e:"üç∑"},{p:"CERVEZA",e:"üç∫"},{p:"BODA",e:"üë∞"},{p:"DIVORCIO",e:"üíî"},{p:"HIJOS",e:"üë∂"},{p:"COMPRA",e:"üõí"},{p:"LIMPIEZA",e:"üßπ"},{p:"COCINAR",e:"üç≥"},{p:"VIAJE",e:"üåç"},{p:"JUBILACI√ìN",e:"üèñÔ∏è"},{p:"GIMNASIO",e:"üí™"},{p:"DIETA",e:"ü•ó"},{p:"DOLOR ESPALDA",e:"üë¥"},{p:"RESACA",e:"ü§¢"},{p:"GASOLINA",e:"‚õΩ"},{p:"FACTURA",e:"üí∏"},{p:"NETFLIX",e:"üì∫"},{p:"SUE√ëO",e:"üí§"},{p:"VACACIONES",e:"üçπ"},{p:"POL√çTICA",e:"üèõÔ∏è"},{p:"INVERSI√ìN",e:"üìà"},{p:"BANCO",e:"üè¶"},{p:"M√ìVIL",e:"üì±"},{p:"INTERNET",e:"üåê"},{p:"DORMIR",e:"üõå"},{p:"RELOJ",e:"‚åö"},{p:"CENA",e:"üçΩÔ∏è"},{p:"FIESTA",e:"üï∫"},{p:"AMOR",e:"üíë"},{p:"SILENCIO",e:"ü§´"},{p:"NATURALEZA",e:"üå≤"},{p:"SALUD",e:"üçé"},{p:"DEPORTE",e:"üö¥"},{p:"LECTURA",e:"üìñ"},{p:"M√öSICA",e:"üéº"},{p:"TEATRO",e:"üé≠"},{p:"MUSEO",e:"üñºÔ∏è"},{p:"CINE",e:"üçø"},{p:"BARRIO",e:"üèòÔ∏è"},{p:"CIUDAD",e:"üèôÔ∏è"},{p:"CAMPO",e:"üöú"},{p:"AVI√ìN",e:"‚úàÔ∏è"},{p:"CRUCERO",e:"üö¢"},{p:"DESCANSO",e:"üßò"}
        ]
    };
    const listaMisiones = ["üêå C√°mara Lenta", "üîä Haciendo Ruidos", "üñêÔ∏è Solo Manos", "ü§ñ Como un Robot", "üëÉ Con la Nariz", "üíÉ Bailando", "üò¥ Muy Cansado", "ü¶ñ Como Dinosaurio", "üßü Como Zombi", "üèÉ Muy R√°pido"];

    let jugadores = [];
    let partida = {};
    let stream;

    function mostrar(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    async function abrirCamara() {
        mostrar('s-cam');
        stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } });
        document.getElementById('camera-feed').srcObject = stream;
    }

    function tomarFoto() {
        const video = document.getElementById('camera-feed');
        const canvas = document.createElement('canvas');
        canvas.width = 300; canvas.height = 300;
        const ctx = canvas.getContext('2d');
        ctx.translate(300, 0); ctx.scale(-1, 1);
        ctx.drawImage(video, 0, 0, 300, 300);
        jugadores.push({ nombre: document.getElementById('in-nombre').value.toUpperCase(), foto: canvas.toDataURL(), votos: 0 });
        if(stream) stream.getTracks().forEach(t => t.stop());
        document.getElementById('in-nombre').value = "";
        actualizarLista(); mostrar('s1');
    }

    function actualizarLista() {
        document.getElementById('lista-jugadores').innerHTML = jugadores.map(j => `<img src="${j.foto}" class="perfil-img">`).join('');
    }

    function iniciarJuego() {
        if(jugadores.length < 2) return alert("A√±ade jugadores");
        const nivel = document.getElementById('select-nivel').value;
        const palabraObj = db[nivel][Math.floor(Math.random() * db[nivel].length)];
        let misiones = [...listaMisiones].sort(() => Math.random() - 0.5);

        partida = { 
            palabra: palabraObj.p,
            emoji: palabraObj.e,
            espiaIdx: Math.floor(Math.random()*jugadores.length),
            turno: 0,
            misionTurno: 0,
            votanteIdx: 0,
            misionesAsignadas: jugadores.map((_, i) => misiones[i % misiones.length])
        };
        mostrar('s2'); prepararTurno();
    }

    function prepararTurno() {
        document.getElementById('turno-de').innerText = "TURNO: " + jugadores[partida.turno].nombre;
        document.getElementById('tap-card').style.display = "block";
        document.getElementById('info-card').style.display = "none";
    }

    function revelarPalabra() {
        const esEspia = (partida.turno === partida.espiaIdx);
        document.getElementById('tap-card').style.display = "none";
        document.getElementById('info-card').style.display = "block";

        if(esEspia) {
            document.getElementById('msg-rol').innerText = "ü§´ ERES EL ESP√çA";
            document.getElementById('box-imagen').innerText = "üïµÔ∏è‚Äç‚ôÇÔ∏è";
            document.getElementById('v-palabra').innerText = "¬°DISIMULA!";
        } else {
            document.getElementById('msg-rol').innerText = "TU PALABRA ES:";
            document.getElementById('box-imagen').innerText = partida.emoji;
            document.getElementById('v-palabra').innerText = partida.palabra;
        }
    }

    function terminarTurno() {
        partida.turno++;
        if(partida.turno < jugadores.length) prepararTurno();
        else { partida.misionTurno = 0; mostrarMision(); }
    }

    function mostrarMision() {
        mostrar('s-misiones');
        const j = jugadores[partida.misionTurno];
        document.getElementById('mision-jugador-nombre').innerText = "M√çMICA DE " + j.nombre;
        document.getElementById('mision-texto').innerText = partida.misionesAsignadas[partida.misionTurno];
    }

    function siguienteMision() {
        partida.misionTurno++;
        if(partida.misionTurno < jugadores.length) mostrarMision();
        else { partida.votanteIdx = 0; mostrar('s-voto'); actualizarVotanteUI(); }
    }

    function actualizarVotanteUI() {
        const votante = jugadores[partida.votanteIdx];
        document.getElementById('votante-nombre').innerText = votante.nombre + " VOTA:";
        const box = document.getElementById('botones-voto');
        box.innerHTML = "";
        jugadores.forEach((suspect, idx) => {
            if(idx !== partida.votanteIdx) {
                const b = document.createElement('button');
                b.className = "btn"; b.innerText = suspect.nombre;
                b.onclick = () => {
                    jugadores[idx].votos++;
                    partida.votanteIdx++;
                    if(partida.votanteIdx < jugadores.length) actualizarVotanteUI();
                    else finalizar();
                };
                box.appendChild(b);
            }
        });
    }

    function finalizar() {
        const culpable = [...jugadores].sort((a,b) => b.votos - a.votos)[0];
        const esEspia = (jugadores.indexOf(culpable) === partida.espiaIdx);
        document.getElementById('wanted-img').src = culpable.foto;
        document.getElementById('wanted-nombre').innerText = culpable.nombre;
        const nombreEspia = jugadores[partida.espiaIdx].nombre;
        
        document.getElementById('resultado-final').innerHTML = esEspia ? 
            "<h2>¬°PILLADO! Era el esp√≠a üïµÔ∏è‚Äç‚ôÇÔ∏è</h2>" : 
            `<h2>¬°ERROR! Era inocente... üò±</h2><p>El esp√≠a era <b>${nombreEspia}</b></p>`;
        mostrar('s-wanted');
    }
</script>
</body>
</html>






