<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Esp√≠a en Ja√©n - Edici√≥n Compartir</title>
    <style>
        :root { 
            --p: #2E7D32; --s: #81C784; --gold: #FFD700; --red: #d32f2f; --wsp: #25D366;
            --bg-night: #050a0f; --bg-day: #4da9ff; --bg-sunset: #ff7e5f;
        }
        
        body { font-family: 'Segoe UI', sans-serif; text-align: center; margin: 0; background: var(--bg-night); color: white; min-height: 100vh; transition: 1s; overflow-x: hidden; }
        
        /* TEMAS DE HORA */
        body.day { background: linear-gradient(var(--bg-day), #2E7D32); }
        body.sunset { background: linear-gradient(var(--bg-sunset), #feb47b); }
        body.night { background: var(--bg-night); }
        
        /* MODO DIBUJO/COLOREAR */
        body.modo-dibujo { background: white !important; color: black !important; }
        body.modo-dibujo .card, body.modo-dibujo .podio-frame, body.modo-dibujo .cromo-pro { 
            border: 3px solid black !important; background: white !important; color: black !important; box-shadow: none !important; 
        }
        body.modo-dibujo img { filter: grayscale(1) contrast(200%) brightness(1.2); border: 2px solid black !important; }
        body.modo-dibujo .btn { border: 2px solid black !important; background: white !important; color: black !important; }
        body.modo-dibujo .lagarto-bg { opacity: 0.1; filter: grayscale(1); }

        .screen { display: none; flex-direction: column; justify-content: center; align-items: center; padding: 20px; min-height: 100vh; box-sizing: border-box; }
        .active { display: flex; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .card { background: white; color: #333; padding: 25px; border-radius: 30px; width: 100%; max-width: 420px; box-shadow: 0 15px 35px rgba(0,0,0,0.5); }
        .btn { border: none; padding: 16px; border-radius: 15px; font-size: 1rem; font-weight: bold; width: 95%; cursor: pointer; margin: 8px 0; color: white; }

        /* PODIO MEJORADO (Basado en tu imagen) */
        .podio-frame {
            position: relative; background: linear-gradient(135deg, #1a2a3a, #0b1a2a);
            border: 4px solid var(--gold); border-radius: 30px; padding: 30px 10px;
            width: 95%; max-width: 600px; display: flex; flex-direction: column; align-items: center; overflow: hidden;
        }
        .lagarto-bg { position: absolute; bottom: -20px; right: -40px; font-size: 18rem; z-index: 0; opacity: 0.4; transform: rotate(-10deg); pointer-events: none; }

        .cromo-pro {
            background: rgba(255,255,255,0.1); border: 2px solid var(--gold); border-radius: 15px;
            padding: 10px; width: 125px; position: relative; z-index: 2; margin: 5px;
        }
        .cromo-img { width: 100%; height: 110px; object-fit: cover; border-radius: 8px; border: 2px solid var(--gold); }
        .acc-icon { position: absolute; top: 5px; left: 5px; font-size: 1.5rem; z-index: 5; }
        .cromo-name { font-weight: bold; color: var(--gold); margin-top: 8px; font-size: 0.9rem; }
        .cromo-pts { font-size: 1.2rem; font-weight: 900; margin: 2px 0; }

        .btn-wsp { background: var(--wsp); display: flex; align-items: center; justify-content: center; gap: 10px; }
        .btn-reset { background: #444; }
        .btn-color { background: white; color: black; border: 2px solid black; }

        footer { font-size: 0.7rem; padding: 15px; background: rgba(0,0,0,0.8); width: 100%; margin-top: auto; border-top: 1px solid var(--gold); }
    </style>
</head>
<body class="night">

<div id="s1" class="screen active">
    <div style="background: rgba(0,0,0,0.6); padding: 25px; border-radius: 40px; border: 2px solid var(--s); width: 90%; max-width: 400px;">
        <h1 id="txt-clima">Esp√≠a en Ja√©n</h1>
        <div id="lista-previa" style="display:flex; justify-content:center; flex-wrap:wrap; margin:10px;"></div>
        <input type="text" id="in-nombre" placeholder="Nombre (Pe, Hache, Jota...)" style="padding:15px; border-radius:15px; width:80%; margin:5px; border:none;">
        <input type="number" id="in-edad" placeholder="Edad" style="padding:15px; border-radius:15px; width:80%; margin:5px; border:none;">
        <button class="btn" style="background:var(--p)" onclick="iniciarCamara()">üì∏ SELFIE</button>
        <button class="btn" style="background:#555" onclick="crearAvatar()">üë§ AVATAR</button>
        <button class="btn" id="btn-next" style="display:none; background:var(--gold); color:black;" onclick="mostrar('s-retos')">CONFIGURAR RETOS üöÄ</button>
    </div>
</div>

<div id="s-cam" class="screen">...</div>
<div id="s-retos" class="screen">...</div>
<div id="s-repaso" class="screen"></div>
<div id="s-game" class="screen"></div>

<div id="s-podio" class="screen">
    <h1 style="color:var(--gold); font-size:2rem; margin-bottom:10px;">üèÜ PODIO DE JA√âN</h1>
    <div class="podio-frame">
        <div class="lagarto-bg">ü¶é</div>
        <div id="final-team-photo" style="display:flex; flex-wrap:wrap; justify-content:center; width:100%;"></div>
        
        <div style="width:100%; margin-top:20px; z-index:5;">
            <button class="btn btn-wsp" onclick="compartirWsp()">
                <span>üì≤</span> Compartir en WhatsApp
            </button>
            <div style="display:flex; gap:10px; justify-content:center;">
                <button class="btn btn-reset" style="width:45%;" onclick="location.reload()">REINICIAR</button>
                <button class="btn btn-color" style="width:45%;" onclick="toggleDibujo()">üñçÔ∏è COLOREAR</button>
            </div>
        </div>
    </div>
</div>

<footer>
    <p>Proyecto Ciudades de Andaluc√≠a | üìß <b>TU_EMAIL@EJEMPLO.COM</b></p>
    <p>¬øTe gusta el juego? <a href="https://paypal.me/TU_PAYPAL" style="color:var(--gold)">Ap√≥yanos aqu√≠</a></p>
</footer>

<script>
    // --- L√ìGICA DE TIEMPO (Petici√≥n 18-01) ---
    function updateTheme() {
        const h = new Date().getHours();
        const b = document.body;
        const t = document.getElementById('txt-clima');
        b.classList.remove('day', 'sunset', 'night');
        if(h < 14) { b.classList.add('day'); t.innerText = "‚òÄÔ∏è Ja√©n (D√≠a)"; }
        else if(h < 19) { b.classList.add('sunset'); t.innerText = "üåá Ja√©n (Tarde)"; }
        else { b.classList.add('night'); t.innerText = "üåô Ja√©n (Noche)"; }
    }
    updateTheme();

    let jugadores = []; let partida = {}; 
    const pueblos = [{n:"Ja√©n",c:"El Lagarto te espera."}, {n:"Linares",c:"Tierra de Raphael."}, {n:"√öbeda",c:"Oro l√≠quido."}, {n:"Baeza",c:"Cuna de poetas."}];

    // --- L√ìGICA DE WHATSAPP ---
    function compartirWsp() {
        // Buscamos al ganador
        let ganador = jugadores.reduce((prev, current) => (prev.puntos > current.puntos) ? prev : current);
        
        let mensaje = `üèÜ *RESULTADOS: ESP√çA EN JA√âN* üïµÔ∏è‚Äç‚ôÇÔ∏è\n\n`;
        mensaje += `ü•á El ganador/a es *${ganador.nombre}* con *${ganador.puntos} puntos*.\n\n`;
        mensaje += `üèÖ Medallas conseguidas:\n`;
        jugadores.forEach(j => {
            mensaje += `- ${j.nombre}: ${j.medallas.map(m => m.n).join(', ') || 'Explorador'}\n`;
        });
        mensaje += `\n¬°Ju√©galo t√∫ tambi√©n en el Proyecto Ciudades de Andaluc√≠a! üå≥üè∫`;

        const url = `https://api.whatsapp.com/send?text=${encodeURIComponent(mensaje)}`;
        window.open(url, '_blank');
    }

    // --- MODO DIBUJO ---
    function toggleDibujo() { document.body.classList.toggle('modo-dibujo'); }

    // (El resto de funciones iniciarCamara, capturarFoto, addJ, finRonda, etc. se mantienen del c√≥digo anterior)
    // Nota: He resumido el JS para que quepa bien, pero mant√©n toda la l√≥gica de los turnos y votos del paso anterior.

    function podio() {
        document.getElementById('final-team-photo').innerHTML = jugadores.map(j => `
            <div class="cromo-pro">
                ${j.acc ? `<div class="acc-icon">${j.acc}</div>` : ''}
                <img src="${j.foto}" class="cromo-img">
                <div class="cromo-name">${j.nombre}</div>
                <div class="cromo-pts">${j.puntos} PTS</div>
                <div style="font-size:0.5rem; color:#aaa;">${j.medallas.map(m=>m.n).join('¬∑')}</div>
            </div>`).join('');
        mostrar('s-podio');
    }

    // [Aqu√≠ ir√≠a el resto de la l√≥gica de juego que ya tienes...]
    // Para simplificar, asumo que ya tienes integradas las funciones de los turnos.
</script>
</body>
</html>
