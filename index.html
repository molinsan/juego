<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Esp√≠a en Ja√©n - Edici√≥n Profesional</title>
    <style>
        :root { --p: #2E7D32; --s: #81C784; --gold: #FFD700; --red: #d32f2f; --dark: #0b1a2a; }
        body { font-family: 'Segoe UI', sans-serif; text-align: center; margin: 0; background: var(--dark); color: white; height: 100vh; overflow-x: hidden; }
        .screen { display: none; flex-direction: column; align-items: center; padding: 10px; min-height: 100vh; box-sizing: border-box; }
        .active { display: flex; }

        /* Pantalla de Inicio Compacta */
        .main-card { background: rgba(0,0,0,0.85); padding: 15px; border-radius: 25px; border: 2px solid var(--s); width: 95%; max-width: 400px; display: flex; flex-direction: column; gap: 8px; }
        .input-row { display: flex; gap: 10px; }
        input[type="text"] { flex: 1; padding: 10px; border-radius: 10px; border: none; }
        
        .avatar-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; background: rgba(255,255,255,0.1); padding: 8px; border-radius: 15px; }
        .av-item { font-size: 1.4rem; cursor: pointer; padding: 5px; border-radius: 8px; border: 2px solid transparent; }
        .av-item.selected { background: var(--p); border-color: var(--gold); }

        /* Botones de Categor√≠a */
        .cat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; }
        .cat-btn { background: #333; padding: 8px; border-radius: 10px; font-size: 0.75rem; border: 2px solid transparent; cursor: pointer; color: white; }
        .cat-btn.selected { background: var(--p); border-color: var(--gold); }

        /* Wanted Frame */
        .wanted-container { 
            width: 300px; height: 400px; position: relative;
            background: url('wanted_frame.png') no-repeat center/contain;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .wanted-photo { width: 180px; height: 180px; object-fit: cover; margin-top: 20px; border: 2px solid #3d2b1f; }
        .wanted-name { font-family: 'Courier New', serif; font-weight: bold; color: #3d2b1f; margin-top: 10px; font-size: 1.5rem; }

        /* Podio Estilo Referencia */
        .podio-layout { 
            display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; padding: 20px;
            background: rgba(11, 26, 42, 0.9); border: 3px solid var(--gold); border-radius: 20px;
        }
        .player-card { 
            background: linear-gradient(to bottom, #f9d976, #f39c12); border-radius: 15px; 
            padding: 10px; width: 140px; color: #333; position: relative;
        }
        .player-img { width: 100%; border-radius: 10px; background: white; }
        .medal-box { display: grid; grid-template-columns: 1fr 1fr; gap: 4px; margin-top: 5px; }
        .medal-tag { background: rgba(0,0,0,0.1); font-size: 0.6rem; border-radius: 5px; padding: 2px; }

        .btn { border: none; padding: 12px; border-radius: 12px; font-weight: bold; width: 100%; cursor: pointer; }
    </style>
</head>
<body>

<div id="s1" class="screen active">
    <div class="main-card">
        <h1 style="font-size:1.2rem; color:var(--gold)">PODIO DE JA√âN</h1>
        <div id="lista-previa" style="display:flex; justify-content:center; gap:5px; flex-wrap:wrap"></div>
        <div class="input-row">
            <input type="text" id="in-nombre" placeholder="Nombre...">
            <input type="color" id="avatar-color" value="#ffffff" style="width:40px">
        </div>
        <div class="avatar-grid" id="av-grid">
            <div class="av-item selected" onclick="selAv(this,'üåà')">üåà</div>
            <div class="av-item" onclick="selAv(this,'üëÆ')">üëÆ</div>
            <div class="av-item" onclick="selAv(this,'üë®‚Äçüöí')">üë®‚Äçüöí</div>
            <div class="av-item" onclick="selAv(this,'ü¶é')">ü¶é</div>
            <div class="av-item" onclick="selAv(this,'ü´í')">ü´í</div>
        </div>
        <div class="cat-grid">
            <div class="cat-btn selected" id="cat-infantil" onclick="selCat('infantil')">üë∂ Infantil<span>(4-6)</span></div>
            <div class="cat-btn" id="cat-junior" onclick="selCat('junior')">üéÆ Junior<span>(7-12)</span></div>
            <div class="cat-btn" id="cat-adolescente" onclick="selCat('adolescente')">üì± Adolescente<span>(13-17)</span></div>
            <div class="cat-btn" id="cat-adulto" onclick="selCat('adulto')">üç∫ Adulto<span>(+18)</span></div>
        </div>
        <button class="btn" style="background:var(--p); color:white" onclick="usarAvatar()">+ A√ëADIR JUGADOR</button>
        <button class="btn" id="btn-next" style="display:none; background:var(--gold)" onclick="mostrar('s-retos')">EMPEZAR üöÄ</button>
    </div>
</div>

<div id="s-retos" class="screen">
    <div class="main-card" style="background:white; color:#333">
        <h3>üéØ Retos de Ronda</h3>
        <p style="font-size:0.7rem">Tacha los que no quieras usar.</p>
        <div id="grid-retos" style="display:grid; grid-template-columns:repeat(5,1fr); gap:5px"></div>
        <button class="btn" style="background:var(--p); color:white; margin-top:10px" onclick="comenzarPartida()">JUGAR</button>
    </div>
</div>

<div id="s-game" class="screen"></div>

<div id="s-round-end" class="screen">
    <div class="main-card">
        <h2 id="round-title"></h2>
        <div id="wanted-area"></div>
        <div style="display:flex; gap:10px; width:100%">
            <button class="btn" style="background:var(--s); color:white" onclick="comenzarPartida()">REPETIR RONDA</button>
            <button class="btn" style="background:var(--gold)" onclick="finalizarPartida()">FINALIZAR PARTIDA</button>
        </div>
    </div>
</div>

<div id="s-podio" class="screen">
    <h1 style="color:var(--gold)">üèÜ PODIO DE JA√âN</h1>
    <div class="podio-layout" id="podio-final"></div>
    <div style="margin-top:20px; display:flex; gap:10px">
        <button class="btn" style="background:#25D366; color:white" onclick="compartirWsp()">üì≤ WHATSAPP</button>
        <button class="btn" style="background:white" onclick="location.reload()">REINICIAR</button>
    </div>
</div>

<script>
    const poolRetos = [{t:"M√çMICA",i:"ü§∏"},{t:"DIBUJO",i:"üé®"},{t:"SONIDOS",i:"üê∂"},{t:"BAILE",i:"üíÉ"},{t:"ROBOT",i:"ü§ñ"},{t:"CANTO",i:"üé§"},{t:"1 PALABRA",i:"üó£Ô∏è"},{t:"ESTATUA",i:"üóø"},{t:"AIRE",i:"üí®"},{t:"SUSURRO",i:"ü§´"}];
    const ciudadesJaen = [
        {n:"And√∫jar", q:"Famosa por su cer√°mica y el lince ib√©rico."},
        {n:"Linares", q:"Cuna de Raphael y famosa por sus minas."},
        {n:"√öbeda", q:"Joyero del Renacimiento andaluz."},
        {n:"Baeza", q:"Ciudad de Antonio Machado y arte en piedra."},
        {n:"Martos", q:"Primer productor mundial de aceite de oliva."},
        {n:"Alcal√° la Real", q:"Dominada por la imponente Fortaleza de la Mota."}
    ];

    let jugadores=[], categoria='infantil', avatarActivo='üåà', retosActivos=[...poolRetos];

    // Render Retos
    const gr = document.getElementById('grid-retos');
    poolRetos.forEach((r,i) => {
        gr.innerHTML += `<div id="r-${i}" onclick="this.classList.toggle('off')" style="cursor:pointer; font-size:1.2rem; background:#eee; padding:5px; border-radius:10px">${r.i}</div>`;
    });

    function selAv(el, icon) {
        document.querySelectorAll('.av-item').forEach(i=>i.classList.remove('selected'));
        el.classList.add('selected'); avatarActivo = icon;
    }

    function selCat(c) {
        categoria = c;
        document.querySelectorAll('.cat-btn').forEach(b=>b.classList.remove('selected'));
        document.getElementById('cat-'+c).classList.add('selected');
    }

    function usarAvatar() {
        const nom = document.getElementById('in-nombre').value || "JUGADOR";
        const col = document.getElementById('avatar-color').value;
        const c = document.createElement('canvas'); c.width=200; c.height=200;
        const ctx = c.getContext('2d');
        ctx.fillStyle = col; ctx.fillRect(0,0,200,200);
        ctx.font = "100px serif"; ctx.textAlign="center"; ctx.textBaseline="middle"; ctx.fillText(avatarActivo, 100, 110);
        
        let acc = "";
        if(nom.toUpperCase().includes("PE")) acc="üåà";
        else if(nom.toUpperCase().includes("HACHE")) acc="üëÆ";
        else if(nom.toUpperCase().includes("JOTA")) acc="üë®‚Äçüöí";

        jugadores.push({nombre: nom.toUpperCase(), foto: c.toDataURL(), puntos: 0, acc: acc, medallas: []});
        document.getElementById('lista-previa').innerHTML += `<img src="${c.toDataURL()}" style="width:30px; border-radius:50%">`;
        if(jugadores.length>=3) document.getElementById('btn-next').style.display="block";
    }

    function mostrar(id){
        document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    function comenzarPartida() {
        let espiaIdx = Math.floor(Math.random()*jugadores.length);
        // L√≥gica de palabras seg√∫n categor√≠a omitida por brevedad
        partida = { espiaIdx, turno: 0 };
        verTurno();
    }

    function verTurno() {
        mostrar('s-game');
        const j = jugadores[partida.turno];
        document.getElementById('s-game').innerHTML = `<div class="main-card" onclick="revelar()"><h2>${j.nombre}</h2><p>TOCA PARA VER</p></div>`;
    }

    function revelar() {
        const esE = (partida.turno === partida.espiaIdx);
        document.getElementById('s-game').innerHTML = `
            <div class="main-card" style="border-color:${esE?'red':'green'}">
                <h1>${esE?'ERES EL ESP√çA':'PALABRA SECRETA'}</h1>
                <button class="btn" onclick="proximo()">OK</button>
            </div>`;
    }

    function proximo() {
        partida.turno++;
        if(partida.turno < jugadores.length) verTurno();
        else finRonda();
    }

    function finRonda() {
        const espia = jugadores[partida.espiaIdx];
        espia.puntos += 10;
        // A√±adir medalla aleatoria de Ja√©n
        const ciudad = ciudadesJaen[Math.floor(Math.random()*ciudadesJaen.length)];
        espia.medallas.push(ciudad.n);

        mostrar('s-round-end');
        document.getElementById('round-title').innerHTML = "¬°RONDA TERMINADA! üèÜ";
        document.getElementById('wanted-area').innerHTML = `
            <div class="wanted-container">
                <img src="${espia.foto}" class="wanted-photo">
                <div class="wanted-name">${espia.nombre}</div>
            </div>`;
    }

    function finalizarPartida() {
        mostrar('s-podio');
        const podio = document.getElementById('podio-final');
        podio.innerHTML = jugadores.map(j => `
            <div class="player-card">
                ${j.acc ? `<div style="position:absolute; top:-10px; right:-10px; font-size:2rem">${j.acc}</div>` : ''}
                <img src="${j.foto}" class="player-img">
                <div style="font-weight:bold">${j.nombre}</div>
                <div style="font-size:0.9rem">${j.puntos} PTS</div>
                <div class="medal-box">
                    ${j.medallas.map(m => `<div class="medal-tag">${m}</div>`).join('')}
                </div>
            </div>
        `).join('');
    }

    function compartirWsp() {
        window.open(`https://api.whatsapp.com/send?text=¬°Mira mi podio en Esp√≠a en Ja√©n!`, '_blank');
    }
</script>
</body>
</html>
