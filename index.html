<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MÃ­mica AndalucÃ­a PRO</title>
    <style>
        :root { --p: #2E7D32; --s: #81C784; --dark: #0b1a2a; --gold: #FFD700; }
        body { font-family: 'Segoe UI', sans-serif; text-align: center; margin: 0; background: var(--dark); color: white; overflow: hidden; }
        
        .screen { display: none; height: 100vh; flex-direction: column; justify-content: center; align-items: center; padding: 20px; box-sizing: border-box; }
        #s1 { background-image: url('inicio.jpeg'); background-size: cover; background-position: center; }
        .active { display: flex; }
        
        .card { background: white; color: #333; padding: 20px; border-radius: 20px; width: 95%; max-width: 400px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .btn { background: var(--p); color: white; border: none; padding: 15px; border-radius: 15px; font-size: 1.1rem; font-weight: bold; width: 85%; cursor: pointer; margin: 8px 0; }
        
        .emoji-display { font-size: 6rem; margin: 10px 0; }
        .mision-icon { font-size: 5rem; margin-bottom: 10px; }
        .pistas-grid { display: flex; justify-content: space-around; background: #f0f0f0; border-radius: 15px; padding: 10px; margin-top: 10px; }
        .pista-item { font-size: 3.5rem; }

        .perfil-img { width: 60px; height: 60px; border-radius: 50%; border: 3px solid var(--s); object-fit: cover; margin: 5px; }
        #camera-feed { width: 100%; border-radius: 20px; transform: scaleX(-1); background: #222; }

        .wanted-container {
            background-image: url('wanted_frame.png');
            background-size: contain; background-repeat: no-repeat; background-position: center;
            width: 350px; height: 450px; display: flex; flex-direction: column; align-items: center;
        }
        .wanted-photo-frame { width: 195px; height: 195px; margin-top: 105px; overflow: hidden; border: 2px solid #3d2b1f; }
        .wanted-photo-frame img { width: 100%; height: 100%; object-fit: cover; filter: sepia(0.7); }
        
        .contacto { font-size: 0.7rem; color: #ccc; margin-top: 10px; line-height: 1.2; }
        .modo-box { background: #f0fdf4; padding: 20px; border-radius: 20px; border: 3px dashed var(--p); margin: 10px 0; }
    </style>
</head>
<body>

<div id="s1" class="screen active">
    <div style="background: rgba(0,0,0,0.7); padding: 20px; border-radius: 20px; width: 90%;">
        <h1 style="color:var(--s); margin:0;">ğŸ° Proyecto AndalucÃ­a</h1>
        <div id="lista-jugadores" style="margin:10px 0"></div>
        <input type="text" id="in-nombre" placeholder="Nombre..." style="padding:12px; border-radius:10px; width:80%; border:none; margin-bottom:10px;">
        <button class="btn" style="background:var(--s); color:black" onclick="abrirCamara()">ğŸ“¸ SELFIE</button>
        <select id="select-nivel" style="padding:12px; width:85%; border-radius:10px;">
            <option value="exp">ğŸ¼ Exploradores (4 a 8 aÃ±os)</option>
            <option value="jun">ğŸ’ Junior (9 a 15 aÃ±os)</option>
            <option value="ado">ğŸ“± Adolescente (16 a 17 aÃ±os)</option>
            <option value="adu">ğŸ· Adultos (+18 aÃ±os)</option>
        </select>
        <button class="btn" onclick="iniciarJuego()" style="background:var(--gold); color:black; margin-top:10px">Â¡EMPEZAR! ğŸš€</button>
        <div class="contacto">ğŸ“© jandropp86@gmail.com | ğŸ’° paypal.me/jandrop86</div>
    </div>
</div>

<div id="s-cam" class="screen">
    <video id="camera-feed" autoplay playsinline style="width:100%"></video>
    <button class="btn" onclick="tomarFoto()">CAPTURAR ğŸ“¸</button>
</div>

<div id="s2" class="screen">
    <div id="tap-card" class="card" onclick="revelarPalabra()">
        <h2 id="turno-de"></h2>
        <div style="font-size:5rem">ğŸ¤«</div>
        <p>TOCA PARA VER TU SECRETO</p>
    </div>
    <div id="info-card" class="card" style="display:none">
        <h3 id="msg-rol"></h3>
        <div id="box-imagen" class="emoji-display"></div>
        <h2 id="v-palabra" style="color:var(--p); margin:5px 0"></h2>
        <div id="pistas-espia" style="display:none">
            <p style="font-size:0.8rem; margin:0">Pistas para disimular:</p>
            <div class="pistas-grid" id="grid-pistas"></div>
        </div>
        <button class="btn" onclick="terminarTurno()">LISTO âœ…</button>
    </div>
</div>

<div id="s-misiones" class="screen">
    <div class="card">
        <h2 id="mision-jugador-nombre" style="margin:0; color:var(--p)"></h2>
        <p>Tu forma de actuar es:</p>
        <div class="modo-box">
            <div id="mision-icon" class="mision-icon"></div>
            <div id="mision-texto" style="font-size:1.4rem; font-weight:bold; color:#333"></div>
        </div>
        <button class="btn" onclick="siguienteMision()">Â¡HECHO! â–¶ï¸</button>
    </div>
</div>

<div id="s-voto" class="screen">
    <div class="card">
        <h2 id="votante-nombre" style="color:var(--p)"></h2>
        <p>Â¿QuiÃ©n es el espÃ­a?</p>
        <div id="botones-voto"></div>
    </div>
</div>

<div id="s-wanted" class="screen">
    <div class="wanted-container">
        <div class="wanted-photo-frame"><img id="wanted-img" src=""></div>
        <div style="color: #3d2b1f; font-family: serif; font-weight: bold; font-size: 1.5rem; margin-top: 10px;" id="wanted-nombre"></div>
    </div>
    <div id="resultado-final" style="margin:15px; background:white; color:black; padding:15px; border-radius:15px; width:80%"></div>
    <button class="btn" onclick="location.reload()">NUEVA PARTIDA ğŸ”„</button>
</div>

<script>
    const db = {
        exp: [{p:"GATO",e:"ğŸ±"},{p:"PERRO",e:"ğŸ¶"},{p:"SOL",e:"â˜€ï¸"},{p:"AVIÃ“N",e:"âœˆï¸"},{p:"PELOTA",e:"âš½"},{p:"TREN",e:"ğŸš‚"},{p:"COMER",e:"ğŸ•"},{p:"DORMIR",e:"ğŸ˜´"},{p:"LLORAR",e:"ğŸ˜¢"},{p:"SALTAR",e:"ğŸ¦˜"}],
        jun: [{p:"BOMBERO",e:"ğŸ‘¨â€ğŸš’"},{p:"POLICIA",e:"ğŸ‘®"},{p:"PIRATA",e:"ğŸ´â€â˜ ï¸"},{p:"MAGO",e:"ğŸ§™"},{p:"ROBOT",e:"ğŸ¤–"},{p:"CIENTÃFICO",e:"ğŸ§ª"},{p:"DETECTIVE",e:"ğŸ•µï¸"},{p:"COCINERO",e:"ğŸ‘¨â€ğŸ³"},{p:"FUTBOLISTA",e:"âš½"},{p:"ESQUIAR",e:"â›·ï¸"}],
        ado: [{p:"TIKTOK",e:"ğŸ’ƒ"},{p:"SELFIE",e:"ğŸ¤³"},{p:"EXAMEN",e:"ğŸ“"},{p:"GIMNASIO",e:"ğŸ‹ï¸"},{p:"MÃšSICA",e:"ğŸ§"},{p:"VIAJE",e:"âœˆï¸"},{p:"AMOR",e:"â¤ï¸"},{p:"DINERO",e:"ğŸ’¸"},{p:"CAFE",e:"â˜•"},{p:"WIFI",e:"ğŸ“¶"}],
        adu: [{p:"HIPOTECA",e:"ğŸ "},{p:"TRABAJO",e:"ğŸ’¼"},{p:"VINO",e:"ğŸ·"},{p:"HIJOS",e:"ğŸ‘¶"},{p:"RESACA",e:"ğŸ¤¢"},{p:"IMPUESTOS",e:"ğŸ§¾"},{p:"LIMPIEZA",e:"ğŸ§¹"},{p:"CENA",e:"ğŸ½ï¸"},{p:"GASOLINA",e:"â›½"},{p:"BODA",e:"ğŸ‘°"}]
    };

    const listaMisiones = [
        {t: "CÃ¡mara Lenta", i: "ğŸŒ"}, {t: "Haciendo Ruidos", i: "ğŸ”Š"}, {t: "Solo con las Manos", i: "ğŸ–ï¸"},
        {t: "Como un Robot", i: "ğŸ¤–"}, {t: "Bailando", i: "ğŸ’ƒ"}, {t: "Muy Cansado", i: "ğŸ˜´"},
        {t: "Como un Dinosaurio", i: "ğŸ¦–"}, {t: "Sin pestaÃ±ear", i: "ğŸ‘ï¸"}, {t: "Muy RÃ¡pido", i: "ğŸƒ"},
        {t: "A la pata coja", i: "ğŸ¦©"}
    ];

    let jugadores = [];
    let partida = {};
    let stream;

    function mostrar(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    async function abrirCamara() {
        if(!document.getElementById('in-nombre').value) return alert("Escribe tu nombre");
        mostrar('s-cam');
        stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } });
        document.getElementById('camera-feed').srcObject = stream;
    }

    function tomarFoto() {
        const canvas = document.createElement('canvas');
        canvas.width = 400; canvas.height = 400;
        canvas.getContext('2d').drawImage(document.getElementById('camera-feed'), 0, 0, 400, 400);
        jugadores.push({ nombre: document.getElementById('in-nombre').value.toUpperCase(), foto: canvas.toDataURL(), votos: 0 });
        stream.getTracks().forEach(t => t.stop());
        document.getElementById('in-nombre').value = "";
        actualizarLista(); mostrar('s1');
    }

    function actualizarLista() {
        document.getElementById('lista-jugadores').innerHTML = jugadores.map(j => `<img src="${j.foto}" class="perfil-img">`).join('');
    }

    function iniciarJuego() {
        if(jugadores.length < 3) return alert("NecesitÃ¡is 3 jugadores mÃ­nimo");
        const nivel = document.getElementById('select-nivel').value;
        const palabraObj = db[nivel][Math.floor(Math.random() * db[nivel].length)];
        let misiones = [...listaMisiones].sort(() => 0.5 - Math.random());
        let falsas = db[nivel].filter(x => x.p !== palabraObj.p).sort(() => 0.5 - Math.random()).slice(0, 2);

        partida = { 
            nivel, palabra: palabraObj.p, emoji: palabraObj.e,
            espiaIdx: Math.floor(Math.random()*jugadores.length),
            turno: 0, misionTurno: 0, votanteIdx: 0,
            pistas: [palabraObj, ...falsas].sort(() => 0.5 - Math.random()),
            misionesAsignadas: jugadores.map((_, i) => misiones[i % misiones.length])
        };
        mostrar('s2'); prepararTurno();
    }

    function prepararTurno() {
        document.getElementById('turno-de').innerText = "TURNO: " + jugadores[partida.turno].nombre;
        document.getElementById('tap-card').style.display = "block";
        document.getElementById('info-card').style.display = "none";
    }

    function revelarPalabra() {
        const esEspia = (partida.turno === partida.espiaIdx);
        document.getElementById('tap-card').style.display = "none";
        document.getElementById('info-card').style.display = "block";
        
        if(!esEspia) {
            document.getElementById('msg-rol').innerText = "TU PALABRA ES:";
            document.getElementById('box-imagen').innerText = partida.emoji;
            document.getElementById('v-palabra').innerText = partida.palabra;
            document.getElementById('pistas-espia').style.display = "none";
        } else {
            document.getElementById('msg-rol').innerText = "ğŸ¤« ERES EL ESPÃA";
            document.getElementById('v-palabra').innerText = "Â¡DISIMULA!";
            if(partida.nivel === 'exp' || partida.nivel === 'jun') {
                document.getElementById('box-imagen').innerText = partida.emoji;
                document.getElementById('pistas-espia').style.display = "none";
            } else {
                document.getElementById('box-imagen').innerText = "ğŸ•µï¸â€â™‚ï¸";
                document.getElementById('pistas-espia').style.display = "block";
                document.getElementById('grid-pistas').innerHTML = partida.pistas.map(p => `<div class="pista-item">${p.e}</div>`).join('');
            }
        }
    }

    function terminarTurno() {
        partida.turno++;
        if(partida.turno < jugadores.length) prepararTurno();
        else { partida.misionTurno = 0; mostrarMision(); }
    }

    function mostrarMision() {
        mostrar('s-misiones');
        const j = jugadores[partida.misionTurno];
        const m = partida.misionesAsignadas[partida.misionTurno];
        document.getElementById('mision-jugador-nombre').innerText = "MÃMICA DE " + j.nombre;
        document.getElementById('mision-icon').innerText = m.i;
        document.getElementById('mision-texto').innerText = m.t;
    }

    function siguienteMision() {
        partida.misionTurno++;
        if(partida.misionTurno < jugadores.length) mostrarMision();
        else { partida.votanteIdx = 0; mostrar('s-voto'); actualizarVotanteUI(); }
    }

    function actualizarVotanteUI() {
        const votante = jugadores[partida.votanteIdx];
        document.getElementById('votante-nombre').innerText = votante.nombre + ", Â¿quiÃ©n es?";
        const box = document.getElementById('botones-voto');
        box.innerHTML = "";
        jugadores.forEach((suspect, idx) => {
            if(idx !== partida.votanteIdx) {
                const b = document.createElement('button');
                b.className = "btn"; b.innerText = suspect.nombre;
                b.onclick = () => {
                    jugadores[idx].votos++;
                    partida.votanteIdx++;
                    if(partida.votanteIdx < jugadores.length) actualizarVotanteUI();
                    else finalizar();
                };
                box.appendChild(b);
            }
        });
    }

    function finalizar() {
        const culpable = [...jugadores].sort((a,b) => b.votos - a.votos)[0];
        const esEspia = (jugadores.indexOf(culpable) === partida.espiaIdx);
        document.getElementById('wanted-img').src = culpable.foto;
        document.getElementById('wanted-nombre').innerText = culpable.nombre;
        const real = jugadores[partida.espiaIdx].nombre;
        document.getElementById('resultado-final').innerHTML = esEspia ? "<h3>Â¡ACERTADO! ğŸ‰</h3> Pillasteis al espÃ­a." : `<h3>Â¡FALLO! ğŸ˜±</h3> El espÃ­a era ${real}.`;
        mostrar('s-wanted');
    }
</script>
</body>
</html>


