<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Esp√≠a en Ja√©n - Edici√≥n Podio</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        :root { --p: #2E7D32; --s: #81C784; --gold: #FFD700; --dark: #0b1a2a; }
        body { font-family: 'Segoe UI', sans-serif; text-align: center; margin: 0; background: var(--dark); color: white; min-height: 100vh; display: flex; flex-direction: column; }
        .screen { display: none; flex-direction: column; align-items: center; padding: 10px; flex: 1; }
        .active { display: flex; }

        /* Estilo Tarjetas Podio (Imagen) */
        .podio-container { background: rgba(255,255,255,0.05); border: 3px solid var(--gold); border-radius: 30px; padding: 20px; width: 95%; max-width: 600px; display: flex; justify-content: space-around; flex-wrap: wrap; position: relative; overflow: hidden; }
        .lagarto-bg { position: absolute; right: -20px; bottom: -20px; font-size: 15rem; opacity: 0.4; z-index: 0; transform: rotate(-15deg); pointer-events: none; }
        
        .card-gold { background: var(--gold); border-radius: 15px; padding: 5px; width: 110px; color: #3d2b1f; font-weight: bold; position: relative; z-index: 1; margin: 5px; }
        .card-gold img { width: 100%; border-radius: 10px; background: white; border: 2px solid #3d2b1f; }
        .points-box { background: rgba(0,0,0,0.1); border-radius: 5px; margin-top: 5px; font-size: 0.9rem; }

        .main-card { background: rgba(0,0,0,0.9); padding: 15px; border-radius: 20px; border: 2px solid var(--s); width: 95%; max-width: 400px; gap: 10px; display: flex; flex-direction: column; }
        .btn { border: none; padding: 12px; border-radius: 15px; font-weight: bold; width: 100%; cursor: pointer; }
        
        /* Footer estilo imagen */
        .footer-ref { background: #000; padding: 10px; font-size: 0.7rem; display: flex; justify-content: center; gap: 15px; border-top: 2px solid var(--gold); width: 100%; }
        .footer-ref b { color: var(--gold); }
    </style>
</head>
<body>

<div id="s1" class="screen active">
    <div class="main-card">
        <h1 style="color:var(--gold); font-size: 1.5rem;">üèÜ PODIO DE JA√âN</h1>
        <div id="lista-previa" style="display:flex; justify-content:center; gap:5px;"></div>
        <input type="text" id="in-nombre" placeholder="Nombre (Pe, Hache, Jota...)" style="padding:12px; border-radius:10px; width:100%; box-sizing:border-box; border:none;">
        <div style="display:flex; gap:5px;">
            <button class="btn" style="background:#444; color:white; flex:1" onclick="iniciarCamara()">üì∏ SELFIE</button>
            <button class="btn" style="background:var(--p); color:white; flex:1" onclick="usarAvatar()">üë§ AVATAR</button>
        </div>
        <button class="btn" id="btn-next" style="display:none; background:var(--gold); color:black" onclick="mostrar('s-retos')">SIGUIENTE üöÄ</button>
    </div>
</div>

<div id="s-retos" class="screen">
    <div class="main-card" style="background:white; color:#333">
        <h3>üéØ Configura Retos</h3>
        <div id="grid-retos" style="display:grid; grid-template-columns:repeat(5,1fr); gap:8px"></div>
        <button class="btn" style="background:var(--p); color:white; margin-top:15px" onclick="comenzarPartida()">EMPEZAR JUEGO</button>
    </div>
</div>

<div id="s-game" class="screen"></div>

<div id="s-final" class="screen">
    <h1 style="color:var(--gold)">üèÜ PODIO DE JA√âN</h1>
    <div class="podio-container">
        <div class="lagarto-bg">ü¶é</div>
        <div id="layout-final" style="display:flex; flex-wrap:wrap; justify-content:center; width:100%;"></div>
    </div>
    <div style="display:flex; gap:10px; margin-top:20px; width:90%; max-width:400px;">
        <button class="btn" style="background:#444; color:white; flex:1" onclick="location.reload()">REINICIAR</button>
        <button class="btn" style="background:white; color:black; flex:1">‚úèÔ∏è COLOREAR</button>
    </div>
</div>

<div class="footer-ref">
    <span>Proyecto Ciudades de Andaluc√≠a</span>
    <span>üì¨ <b>molinsan.jl@gmail.com</b></span>
    <span>‚òï <b>PayPal (7moli)</b></span>
</div>

<script>
    const niveles = { infantil: [{p:"SOL ‚òÄÔ∏è", s:"LUNA üåô"}], junior:[{p:"PIZZA", s:"HAMBURGUESA"}], adolescente:[{p:"TIKTOK", s:"REELS"}], adulto:[{p:"ACEITE", s:"VINO"}] };
    const poolRetos = [{i:"ü§∏",t:"M√≠mica"},{i:"üé®",t:"Dibujo"},{i:"üê∂",t:"Sonido"},{i:"üíÉ",t:"Baile"},{i:"ü§ñ",t:"Robot"},{i:"üé§",t:"Canto"},{i:"üó£Ô∏è",t:"Palabra"},{i:"üóø",t:"Estatua"},{i:"üí®",t:"Aire"},{i:"ü§´",t:"Susurro"}];
    let jugadores=[], partida={};

    // Al cargar: Llenar retos
    window.onload = () => {
        const gr = document.getElementById('grid-retos');
        poolRetos.forEach((r,i) => gr.innerHTML += `<div id="reto-${i}" style="background:#eee; padding:10px; border-radius:10px; cursor:pointer;" onclick="this.style.opacity=(this.style.opacity=='0.3'?'1':'0.3')"><b>${r.i}</b></div>`);
    };

    function addJ(img) {
        const nom = (document.getElementById('in-nombre').value || "Jugador").toUpperCase();
        jugadores.push({nombre: nom, foto: img, puntos: 0, acc: nom.includes("PE")?"üåà":nom.includes("HACHE")?"üëÆ":nom.includes("JOTA")?"üë®‚Äçüöí":""});
        document.getElementById('lista-previa').innerHTML += `<img src="${img}" style="width:30px; border-radius:50%; border:1px solid var(--gold)">`;
        document.getElementById('in-nombre').value = "";
        if(jugadores.length>=3) document.getElementById('btn-next').style.display="block";
    }

    function usarAvatar() {
        const c = document.createElement('canvas'); c.width=200; c.height=200;
        const ctx = c.getContext('2d'); ctx.fillStyle = '#'+Math.floor(Math.random()*16777215).toString(16); ctx.fillRect(0,0,200,200);
        ctx.font = "100px serif"; ctx.textAlign="center"; ctx.textBaseline="middle"; ctx.fillText("üïµÔ∏è", 100, 110);
        addJ(c.toDataURL());
    }

    function comenzarPartida() {
        // Orden aleatorio de turnos
        partida.orden = [...jugadores].sort(() => Math.random() - 0.5);
        partida.espiaIdx = Math.floor(Math.random() * jugadores.length);
        partida.turnoActual = 0;
        
        // Asignar retos
        const activos = poolRetos.filter((r,i) => document.getElementById(`reto-${i}`).style.opacity !== '0.3');
        jugadores.forEach(j => j.reto = activos[Math.floor(Math.random()*activos.length)]);
        
        verTurno();
    }

    function verTurno() {
        mostrar('s-game');
        const j = partida.orden[partida.turnoActual];
        document.getElementById('s-game').innerHTML = `
            <div class="main-card" onclick="revelar()">
                <img src="${j.foto}" style="width:100px; border-radius:50%; margin:auto; border:3px solid var(--gold)">
                <h2>TURNO DE: ${j.nombre}</h2>
                <p>PULSA PARA VER TU SECRETO</p>
            </div>`;
    }

    function revelar() {
        const j = partida.orden[partida.turnoActual];
        const esE = (j === jugadores[partida.espiaIdx]);
        document.getElementById('s-game').innerHTML = `
            <div class="main-card" style="border-color:${esE?'red':'green'}">
                <h1>${esE ? 'ERES EL ESP√çA' : 'PALABRA: ACEITE'}</h1>
                <p style="color:var(--gold)">RETO: ${j.reto.i} ${j.reto.t}</p>
                <button class="btn" style="background:var(--p); color:white" onclick="siguienteTurno()">ENTENDIDO</button>
            </div>`;
    }

    function siguienteTurno() {
        partida.turnoActual++;
        if(partida.turnoActual < jugadores.length) verTurno();
        else pantallaRepaso();
    }

    function pantallaRepaso() {
        let items = partida.orden.map(j => `<li><b>${j.nombre}:</b> ${j.reto.i}</li>`).join('');
        document.getElementById('s-game').innerHTML = `
            <div class="main-card">
                <h3>üì¢ ¬°A JUGAR!</h3>
                <ul style="text-align:left">${items}</ul>
                <button class="btn" style="background:var(--gold); color:black" onclick="pantallaVotacion(0)">EMPEZAR VOTACI√ìN üó≥Ô∏è</button>
            </div>`;
    }

    function pantallaVotacion(votaIdx) {
        if(votaIdx >= jugadores.length) return calcularResultado();
        const jVota = jugadores[votaIdx];
        const opciones = jugadores.filter(j => j !== jVota).map(j => 
            `<button class="btn" style="background:#444; color:white; margin:2px" onclick="votar(${votaIdx}, '${j.nombre}')">${j.nombre}</button>`
        ).join('');
        
        document.getElementById('s-game').innerHTML = `
            <div class="main-card">
                <h3>VOTA ${jVota.nombre}</h3>
                <p>¬øQui√©n crees que es el esp√≠a?</p>
                ${opciones}
            </div>`;
    }

    let votosRecibidos = [];
    function votar(votaIdx, sospechoso) {
        votosRecibidos.push(sospechoso);
        pantallaVotacion(votaIdx + 1);
    }

    function calcularResultado() {
        const espiaReal = jugadores[partida.espiaIdx];
        jugadores.forEach((j, i) => {
            if(votosRecibidos[i] === espiaReal.nombre) j.puntos += 10;
        });
        
        mostrar('s-final');
        const layout = document.getElementById('layout-final');
        layout.innerHTML = jugadores.map(j => `
            <div class="card-gold">
                ${j.acc ? `<div style="position:absolute; top:-10px; right:0; font-size:1.5rem">${j.acc}</div>` : ''}
                <img src="${j.foto}">
                <div style="font-size:0.8rem">${j.nombre}</div>
                <div class="points-box">${j.puntos} PTS</div>
            </div>
        `).join('');
        
        confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
    }

    function mostrar(id){ document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active')); document.getElementById(id).classList.add('active'); }
    function iniciarCamara() { alert("Simulando c√°mara..."); usarAvatar(); }
</script>
</body>
</html>
